# 数据库设计文档

## 数据库概述

本系统使用MySQL 8.0数据库，数据库名称为`lucky_sms`，字符集为utf8mb4。

## 数据表结构

### 1. users - 用户表
存储系统所有用户的基本信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| user_id | INT | 用户ID | 主键，自增 |
| username | VARCHAR(50) | 用户名 | 唯一，非空 |
| password | VARCHAR(255) | 密码 | 非空（BCrypt加密） |
| phone | VARCHAR(20) | 手机号 | |
| email | VARCHAR(100) | 邮箱 | |
| avatar | VARCHAR(255) | 头像URL | |
| real_name | VARCHAR(50) | 真实姓名 | |
| gender_id | INT | 性别ID | 默认1 |
| birthday | DATE | 生日 | |
| address | VARCHAR(255) | 地址 | |
| user_type_id | INT | 用户类型ID | 1-学生，2-教师，3-管理员 |
| status_id | INT | 状态ID | 默认1（正常） |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_username: username
- idx_user_type: user_type_id

### 2. students - 学生表
存储学生的详细信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| student_id | INT | 学生ID | 主键，自增 |
| user_id | INT | 用户ID | 外键，非空 |
| student_no | VARCHAR(20) | 学号 | 唯一，非空 |
| department_id | INT | 学院ID | 外键 |
| major_id | INT | 专业ID | 外键 |
| class_id | INT | 班级ID | 外键 |
| enrollment_date | DATE | 入学日期 | |
| graduation_date | DATE | 毕业日期 | |
| education_years | INT | 学制 | 默认4 |
| education_level_id | INT | 学历层次ID | 默认1 |
| status_id | INT | 状态ID | 默认1 |
| emergency_contact | VARCHAR(50) | 紧急联系人 | |
| emergency_phone | VARCHAR(20) | 紧急联系电话 | |
| parent_name | VARCHAR(50) | 家长姓名 | |
| parent_phone | VARCHAR(20) | 家长电话 | |
| home_address | VARCHAR(255) | 家庭住址 | |
| high_school | VARCHAR(100) | 毕业高中 | |
| entrance_score | DECIMAL(5,2) | 高考分数 | |
| scholarship_info | TEXT | 奖学金信息 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_student_no: student_no
- idx_department: department_id

**外键**：
- user_id → users(user_id)

### 3. teachers - 教师表
存储教师的详细信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| teacher_id | INT | 教师ID | 主键，自增 |
| user_id | INT | 用户ID | 外键，非空 |
| teacher_no | VARCHAR(20) | 教师工号 | 唯一，非空 |
| department_id | INT | 学院ID | 外键 |
| title_id | INT | 职称ID | 外键 |
| status_id | INT | 状态ID | 默认1 |
| education | VARCHAR(50) | 学历 | |
| research_area | VARCHAR(100) | 研究方向 | |
| office_phone | VARCHAR(20) | 办公电话 | |
| office_location | VARCHAR(100) | 办公地点 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_teacher_no: teacher_no
- idx_department: department_id

**外键**：
- user_id → users(user_id)

### 4. departments - 学院表
存储学院信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| department_id | INT | 学院ID | 主键，自增 |
| department_name | VARCHAR(100) | 学院名称 | 非空 |
| department_code | VARCHAR(20) | 学院代码 | 唯一，非空 |
| description | TEXT | 描述 | |
| status_id | INT | 状态ID | 默认1 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_department_code: department_code

### 5. majors - 专业表
存储专业信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| major_id | INT | 专业ID | 主键，自增 |
| major_name | VARCHAR(100) | 专业名称 | 非空 |
| major_code | VARCHAR(20) | 专业代码 | 唯一，非空 |
| department_id | INT | 学院ID | 外键 |
| description | TEXT | 描述 | |
| status_id | INT | 状态ID | 默认1 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_major_code: major_code

**外键**：
- department_id → departments(department_id)

### 6. classes - 班级表
存储班级信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| class_id | INT | 班级ID | 主键，自增 |
| class_name | VARCHAR(50) | 班级名称 | 非空 |
| class_code | VARCHAR(20) | 班级代码 | 唯一，非空 |
| major_id | INT | 专业ID | 外键 |
| department_id | INT | 学院ID | |
| grade_year | INT | 年级 | |
| student_count | INT | 学生人数 | 默认0 |
| status_id | INT | 状态ID | 默认1 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_class_code: class_code

### 7. courses - 课程表
存储课程信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| course_id | INT | 课程ID | 主键，自增 |
| course_code | VARCHAR(20) | 课程代码 | 唯一，非空 |
| course_name | VARCHAR(100) | 课程名称 | 非空 |
| course_type_id | INT | 课程类型ID | 默认1 |
| credit | DECIMAL(3,1) | 学分 | 非空 |
| total_hours | INT | 总学时 | 非空 |
| theory_hours | INT | 理论学时 | 默认0 |
| practice_hours | INT | 实践学时 | 默认0 |
| department_id | INT | 学院ID | 外键 |
| major_id | INT | 专业ID | 外键 |
| description | TEXT | 课程描述 | |
| syllabus | TEXT | 教学大纲 | |
| textbook | VARCHAR(255) | 教材 | |
| prerequisites | TEXT | 先修课程 | |
| is_compulsory | BOOLEAN | 是否必修 | 默认TRUE |
| status_id | INT | 状态ID | 默认1 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_course_code: course_code
- idx_department: department_id

### 8. semesters - 学期表
存储学期信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| semester_id | INT | 学期ID | 主键，自增 |
| semester_name | VARCHAR(50) | 学期名称 | 非空 |
| semester_code | VARCHAR(20) | 学期代码 | 唯一，非空 |
| semester_type_id | INT | 学期类型ID | 默认1 |
| start_date | DATE | 开始日期 | |
| end_date | DATE | 结束日期 | |
| status_id | INT | 状态ID | 默认1 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_semester_code: semester_code

### 9. teaching_assignments - 教学任务表
存储教学任务分配信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| assignment_id | INT | 任务ID | 主键，自增 |
| course_id | INT | 课程ID | 外键，非空 |
| teacher_id | INT | 教师ID | 外键，非空 |
| semester_id | INT | 学期ID | 外键，非空 |
| class_id | INT | 班级ID | 外键 |
| max_students | INT | 最大人数 | 默认50 |
| current_students | INT | 当前人数 | 默认0 |
| classroom | VARCHAR(50) | 教室 | |
| schedule | VARCHAR(255) | 上课时间 | |
| status_id | INT | 状态ID | 默认1 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_course_semester: course_id, semester_id

**外键**：
- course_id → courses(course_id)
- teacher_id → teachers(teacher_id)
- semester_id → semesters(semester_id)

### 10. course_selections - 选课记录表
存储学生选课信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| selection_id | INT | 选课ID | 主键，自增 |
| student_id | INT | 学生ID | 外键，非空 |
| assignment_id | INT | 教学任务ID | 外键，非空 |
| selection_time | DATETIME | 选课时间 | 默认当前时间 |
| selection_type_id | INT | 选课类型ID | 默认1 |
| priority | INT | 优先级 | 默认1 |
| status_id | INT | 状态ID | 默认1 |
| drop_time | DATETIME | 退课时间 | |
| drop_reason | VARCHAR(255) | 退课原因 | |
| final_grade | DECIMAL(5,2) | 最终成绩 | |
| attendance_rate | DECIMAL(5,2) | 出勤率 | |
| evaluation_score | DECIMAL(5,2) | 评价分数 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- uk_student_assignment: student_id, assignment_id (唯一)
- idx_student_semester: student_id, assignment_id

**外键**：
- student_id → students(student_id)
- assignment_id → teaching_assignments(assignment_id)

### 11. course_grades - 成绩表
存储课程成绩详细信息

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| grade_id | INT | 成绩ID | 主键，自增 |
| selection_id | INT | 选课ID | 外键，非空 |
| usual_score | DECIMAL(5,2) | 平时成绩 | |
| midterm_score | DECIMAL(5,2) | 期中成绩 | |
| final_score | DECIMAL(5,2) | 期末成绩 | |
| total_score | DECIMAL(5,2) | 总成绩 | |
| grade_level | VARCHAR(10) | 等级（A/B/C/D/F） | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_selection: selection_id

**外键**：
- selection_id → course_selections(selection_id)

### 12. status_types - 状态类型表
存储各种状态类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| status_id | INT | 状态ID | 主键，自增 |
| status_name | VARCHAR(50) | 状态名称 | 非空 |
| status_code | VARCHAR(20) | 状态代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**初始数据**：
- 1: 正常 (active)
- 2: 禁用 (disabled)
- 3: 已删除 (deleted)
- 4: 待审核 (pending)
- 5: 已通过 (approved)
- 6: 已拒绝 (rejected)

### 12.1. gender_types - 性别类型表
存储性别类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| gender_id | INT | 性别ID | 主键，自增 |
| gender_name | VARCHAR(10) | 性别名称 | 非空 |
| gender_code | VARCHAR(10) | 性别代码 | 唯一，非空 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**索引**：
- idx_gender_code: gender_code

**初始数据**：
- 1: 男 (MALE)
- 2: 女 (FEMALE)
- 3: 其他 (OTHER)

### 12.2. user_types - 用户类型表
存储用户类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| user_type_id | INT | 类型ID | 主键，自增 |
| type_name | VARCHAR(50) | 类型名称 | 非空 |
| type_code | VARCHAR(20) | 类型代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**索引**：
- idx_type_code: type_code

**初始数据**：
- 1: 学生 (STUDENT)
- 2: 教师 (TEACHER)
- 3: 管理员 (ADMIN)

### 12.3. semester_types - 学期类型表
存储学期类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| semester_type_id | INT | 类型ID | 主键，自增 |
| type_name | VARCHAR(50) | 类型名称 | 非空 |
| type_code | VARCHAR(20) | 类型代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**索引**：
- idx_type_code: type_code

**初始数据**：
- 1: 第一学期 (FIRST)
- 2: 第二学期 (SECOND)

### 12.4. education_levels - 学历等级表
存储学历等级

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| education_level_id | INT | 等级ID | 主键，自增 |
| level_name | VARCHAR(50) | 等级名称 | 非空 |
| level_code | VARCHAR(20) | 等级代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**索引**：
- idx_level_code: level_code

**初始数据**：
- 1: 本科 (UNDERGRADUATE)
- 2: 硕士 (MASTER)
- 3: 博士 (DOCTOR)

### 13. course_types - 课程类型表
存储课程类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| course_type_id | INT | 类型ID | 主键，自增 |
| type_name | VARCHAR(50) | 类型名称 | 非空 |
| type_code | VARCHAR(20) | 类型代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**初始数据**：
- 1: 必修课 (compulsory)
- 2: 选修课 (elective)
- 3: 通识课 (general)
- 4: 实践课 (practice)

### 14. selection_types - 选课类型表
存储选课类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| selection_type_id | INT | 类型ID | 主键，自增 |
| type_name | VARCHAR(50) | 类型名称 | 非空 |
| type_code | VARCHAR(20) | 类型代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**初始数据**：
- 1: 正常选课 (normal)
- 2: 补选 (makeup)
- 3: 重修 (retake)
- 4: 免修 (exempt)

### 15. titles - 职称表
存储教师职称

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| title_id | INT | 职称ID | 主键，自增 |
| title_name | VARCHAR(50) | 职称名称 | 非空 |
| title_code | VARCHAR(20) | 职称代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**初始数据**：
- 1: 助教 (assistant)
- 2: 讲师 (lecturer)
- 3: 副教授 (associate_professor)
- 4: 教授 (professor)

### 16. announcements - 公告表
存储系统公告

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| announcement_id | INT | 公告ID | 主键，自增 |
| title | VARCHAR(200) | 标题 | 非空 |
| content | TEXT | 内容 | |
| publisher_id | INT | 发布者ID | 外键 |
| department_id | INT | 部门ID | 外键 |
| announcement_type_id | INT | 公告类型ID | 外键，默认1 |
| priority | INT | 优先级 | 默认0（0-普通，1-重要，2-紧急） |
| target_audience | VARCHAR(20) | 受众 | 默认'ALL'（ALL-全体，STUDENT-学生，TEACHER-教师） |
| status_id | INT | 状态ID | 默认1 |
| publish_time | DATETIME | 发布时间 | 默认当前时间 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 自动更新 |

**索引**：
- idx_publish_time: publish_time
- idx_department: department_id
- idx_type: announcement_type_id
- idx_audience: target_audience
- idx_publisher: publisher_id

**外键**：
- publisher_id → users(user_id)
- department_id → departments(department_id)
- announcement_type_id → announcement_types(announcement_type_id)
- status_id → status_types(status_id)

### 16.1. announcement_types - 公告类型表
存储公告类型

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| announcement_type_id | INT | 类型ID | 主键，自增 |
| type_name | VARCHAR(50) | 类型名称 | 非空 |
| type_code | VARCHAR(20) | 类型代码 | 唯一，非空 |
| description | VARCHAR(255) | 描述 | |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**索引**：
- idx_type_code: type_code

**初始数据**：
- 1: 通知公告 (NOTICE)
- 2: 校园招聘 (RECRUITMENT)
- 3: 学术讲座 (LECTURE)
- 4: 活动通知 (EVENT)
- 5: 紧急通知 (URGENT)
- 6: 教学安排 (TEACHING)
- 7: 成果申报 (ACHIEVEMENT)
- 8: 培训通知 (TRAINING)
- 9: 检查通知 (INSPECTION)

### 17. announcement_reads - 公告阅读记录表
存储公告阅读记录

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|--------|
| read_id | INT | 阅读ID | 主键，自增 |
| announcement_id | INT | 公告ID | 外键，非空 |
| user_id | INT | 用户ID | 外键，非空 |
| read_time | DATETIME | 阅读时间 | 默认当前时间 |

**索引**：
- uk_announcement_user: announcement_id, user_id (唯一)
- idx_user: user_id
- idx_announcement: announcement_id
- idx_read_time: read_time

**外键**：
- announcement_id → announcements(announcement_id)
- user_id → users(user_id)

## ER关系图

```
users (用户表)
  ├─ students (学生表) [1:1]
  ├─ teachers (教师表) [1:1]
  
departments (学院表)
  ├─ majors (专业表) [1:N]
  ├─ classes (班级表) [1:N]
  ├─ courses (课程表) [1:N]
  ├─ students (学生表) [1:N]
  └─ teachers (教师表) [1:N]

majors (专业表)
  ├─ classes (班级表) [1:N]
  ├─ students (学生表) [1:N]
  └─ courses (课程表) [1:N]

semesters (学期表)
  └─ teaching_assignments (教学任务表) [1:N]

courses (课程表)
  └─ teaching_assignments (教学任务表) [1:N]

teachers (教师表)
  └─ teaching_assignments (教学任务表) [1:N]

teaching_assignments (教学任务表)
  └─ course_selections (选课记录表) [1:N]

students (学生表)
  └─ course_selections (选课记录表) [1:N]

course_selections (选课记录表)
  └─ course_grades (成绩表) [1:1]

announcements (公告表)
  ├─ announcement_reads (公告阅读记录表) [1:N]
  └─ users (用户表) [N:1] (发布者)

announcement_types (公告类型表)
  └─ announcements (公告表) [1:N]
```

## 数据库初始化

### 默认账号密码
所有默认密码均为 `123456`，使用BCrypt加密后存储。

### 初始数据
系统初始化时会创建以下数据：
- 5个学院
- 5个专业
- 4个班级
- 3个学期
- 8门课程
- 6个教学任务
- 5个用户（1个管理员，2个教师，2个学生）
- 5条选课记录
- 5条成绩记录

## 注意事项

1. 所有密码使用BCrypt加密存储
2. 用户类型：1-学生，2-教师，3-管理员
3. 默认状态为1（正常）
4. 时间字段统一使用DATETIME类型
5. 外键关联确保数据完整性
6. 索引优化查询性能
