# Lucky SMS 学生管理系统数据库设计文档

## 1. 数据库概述

### 1.1 数据库基本信息
- **数据库名称**: Lucky_SMS
- **数据库类型**: 关系型数据库 (MySQL)
- **字符集**: UTF-8
- **排序规则**: utf8_general_ci
- **SQL模式**: STRICT_ALL_TABLES (严格模式，确保数据完整性)

### 1.2 设计原则
- 遵循第三范式(3NF)，减少数据冗余
- 使用合适的数据类型和约束确保数据完整性
- 设计合理的索引提高查询性能
- 使用外键约束保证数据一致性
- 采用统一的命名规范
- 添加适当的注释提高可读性

### 1.3 系统功能模块
- 用户管理模块
- 权限管理模块
- 教学管理模块
- 图书馆管理模块
- 系统管理模块
- 统计分析模块

## 2. 数据库架构

### 2.1 数据库ER图

```
[用户表] 1--N [学生表] N--1 [班级表] N--1 [专业表] N--1 [学院表]
   |                                     |                   |
   |                                     |                   |
   +--N [教师表] N--1 [职称表]           |                   |
   |                                     |                   |
   +--N [用户角色表] N--N [角色表] N--N [角色权限表] N--N [权限表]
   |
   +--N [图书借阅表] N--1 [图书表] N--1 [图书分类表]
   |
   +--N [系统操作日志表]
   |
   +--N [待办事项表]
   |
   +--N [用户地址表]

[课程表] N--N [教师授课表] N--1 [学期表]
   |               |
   |               +--N [学生选课表] N--1 [学生表]
   |               |
   |               +--1 [成绩表] N--1 [成绩审核状态表]
   |
   +--N [课程先修关系表] N--1 [课程表]

[学院表] 1--N [教师表] (院长关系)
```

### 2.2 表分类

#### 2.2.1 基础字典表（低依赖）
- 用户表 (users)
- 角色表 (roles)
- 权限表 (permissions)
- 学生状态表 (student_statuses)
- 教师状态表 (teacher_statuses)
- 职称表 (teacher_titles)
- 成绩审核状态表 (grade_review_statuses)
- 图书借阅状态表 (book_borrow_statuses)
- 图书分类表 (book_categories)

#### 2.2.2 组织架构表
- 学院表 (departments)
- 专业表 (majors)
- 班级表 (class_info)

#### 2.2.3 人员信息表
- 教师表 (teachers)
- 学生表 (students)

#### 2.2.4 教学管理表
- 课程表 (courses)
- 学期表 (semesters)
- 教师授课表 (teaching_assignments)
- 学生选课表 (course_selections)
- 成绩表 (course_grades)
- 课程先修关系表 (course_prerequisites)

#### 2.2.5 图书管理表
- 图书表 (books)
- 图书预约表 (book_reservations)
- 图书借阅表 (book_borrowings)

#### 2.2.6 系统管理表
- 系统配置表 (system_config)
- 系统操作日志表 (system_audit_log)
- ID变更表 (id_changes)
- 选课冲突记录表 (course_schedule_conflicts)

#### 2.2.7 辅助功能表
- 待办事项表 (todos)
- 公告表 (announcements)
- 用户地址表 (user_addresses)

## 3. 表结构详细设计

### 3.1 基础字典表

#### 3.1.1 用户表 (users)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| user_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 用户ID（主键） |
| username | VARCHAR(50) | UNIQUE, NOT NULL | - | 用户名（全局唯一） |
| password_hash | VARCHAR(255) | NOT NULL | - | 加密后的密码 |
| email | VARCHAR(100) | UNIQUE | - | 电子邮箱 |
| phone | VARCHAR(20) | UNIQUE, NOT NULL | - | 手机号码 |
| gender | ENUM('M', 'F', 'O') | - | 'O' | 性别（M-男，F-女，O-其他） |
| birth_date | DATE | - | - | 出生日期 |
| avatar_url | VARCHAR(255) | - | - | 头像URL |
| external_id | VARCHAR(50) | UNIQUE | - | 外部系统ID |
| status | ENUM('ACTIVE', 'INACTIVE') | - | 'ACTIVE' | 用户状态 |
| last_login_time | TIMESTAMP | NULL | - | 最后登录时间 |
| last_login_ip | VARCHAR(50) | - | - | 最后登录IP |
| last_password_change_time | TIMESTAMP | NULL | - | 密码最后修改时间 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| created_by | INT | FOREIGN KEY (users.user_id) | - | 创建人ID |
| updated_by | INT | FOREIGN KEY (users.user_id) | - | 更新人ID |

**索引**:
- idx_username (username)
- idx_email (email)
- idx_phone (phone)
- idx_status (status)

**约束**:
- chk_birth_date: birth_date IS NULL OR birth_date >= '1900-01-01'

#### 3.1.2 角色表 (roles)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| role_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 角色ID（主键） |
| role_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 角色名称（全局唯一） |
| description | VARCHAR(255) | - | - | 角色描述 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_role_name (role_name)

#### 3.1.3 用户-角色关联表 (user_roles)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| user_id | INT | PRIMARY KEY, FOREIGN KEY (users.user_id) | - | 用户ID（外键） |
| role_id | INT | PRIMARY KEY, FOREIGN KEY (roles.role_id) | - | 角色ID（外键） |
| assigned_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 分配时间 |
| assigned_by | INT | FOREIGN KEY (users.user_id) | - | 分配人ID（外键） |

**索引**:
- idx_user_id (user_id)
- idx_role_id (role_id)

#### 3.1.4 权限表 (permissions)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| permission_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 权限ID（主键） |
| permission_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 权限名称（全局唯一） |
| description | VARCHAR(255) | - | - | 权限描述 |
| module | VARCHAR(50) | NOT NULL | - | 所属功能模块 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_permission_name (permission_name)
- idx_module (module)

#### 3.1.5 角色-权限关联表 (role_permissions)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| role_id | INT | PRIMARY KEY, FOREIGN KEY (roles.role_id) | - | 角色ID（外键） |
| permission_id | INT | PRIMARY KEY, FOREIGN KEY (permissions.permission_id) | - | 权限ID（外键） |
| assigned_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 分配时间 |
| assigned_by | INT | FOREIGN KEY (users.user_id) | - | 分配人ID（外键） |

#### 3.1.6 学生状态表 (student_statuses)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| status_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 状态ID（主键） |
| status_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 状态名称（全局唯一） |
| description | VARCHAR(255) | - | - | 状态描述 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_status_name (status_name)

#### 3.1.7 教师状态表 (teacher_statuses)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| status_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 状态ID（主键） |
| status_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 状态名称（全局唯一） |
| description | VARCHAR(255) | - | - | 状态描述 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_status_name (status_name)

#### 3.1.8 职称表 (teacher_titles)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| title_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 职称ID（主键） |
| title_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 职称名称（全局唯一） |
| title_level | TINYINT | NOT NULL | - | 职称级别（1-初级，2-中级，3-高级） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_title_name (title_name)
- idx_title_level (title_level)

**约束**:
- chk_title_level: title_level IN (1, 2, 3)

#### 3.1.9 成绩审核状态表 (grade_review_statuses)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| status_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 状态ID（主键） |
| status_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 状态名称（全局唯一） |
| description | VARCHAR(255) | - | - | 状态描述 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_status_name (status_name)

#### 3.1.10 图书借阅状态表 (book_borrow_statuses)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| status_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 状态ID（主键） |
| status_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 状态名称（全局唯一） |
| description | VARCHAR(255) | - | - | 状态描述 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_status_name (status_name)

#### 3.1.11 图书分类表 (book_categories)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| category_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 分类ID（主键） |
| category_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 分类名称（全局唯一） |
| parent_id | INT | FOREIGN KEY (book_categories.category_id) | - | 父分类ID（外键），NULL表示顶级分类 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_parent_id (parent_id)

### 3.2 组织架构表

#### 3.2.1 学院表 (departments)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| department_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 学院ID（主键） |
| department_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 学院名称（全局唯一） |
| department_code | VARCHAR(10) | UNIQUE, NOT NULL | - | 学院代码（全局唯一） |
| dean_id | INT | FOREIGN KEY (teachers.teacher_id) | - | 院长ID（外键，关联教师表） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_department_code (department_code)

#### 3.2.2 专业表 (majors)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| major_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 专业ID（主键） |
| major_name | VARCHAR(50) | NOT NULL | - | 专业名称 |
| department_id | INT | NOT NULL, FOREIGN KEY (departments.department_id) | - | 所属学院ID（外键） |
| major_code | VARCHAR(10) | UNIQUE, NOT NULL | - | 专业代码（全局唯一） |
| required_credits | DECIMAL(5,2) | NOT NULL | 0.00 | 应修学分 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_major_code (major_code)
- idx_department_id (department_id)

**约束**:
- chk_required_credits: required_credits >= 0

#### 3.2.3 班级表 (class_info)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| class_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 班级ID（主键） |
| class_name | VARCHAR(50) | UNIQUE, NOT NULL | - | 班级名称（全局唯一） |
| major_id | INT | NOT NULL, FOREIGN KEY (majors.major_id) | - | 所属专业ID（外键） |
| enrollment_year | YEAR | NOT NULL | - | 入学年份 |
| class_advisor_id | INT | FOREIGN KEY (teachers.teacher_id) | - | 班主任ID（外键，关联教师表） |
| classroom | VARCHAR(50) | - | - | 固定教室 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_class_name (class_name)
- idx_major_id (major_id)
- idx_enrollment_year (enrollment_year)

**约束**:
- chk_enrollment_year: enrollment_year >= 2000

### 3.3 人员信息表

#### 3.3.1 教师表 (teachers)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| teacher_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 教师ID（主键） |
| user_id | INT | UNIQUE, NOT NULL, FOREIGN KEY (users.user_id) | - | 用户ID（外键） |
| department_id | INT | NOT NULL, FOREIGN KEY (departments.department_id) | - | 学院ID（外键） |
| title_id | INT | NOT NULL, FOREIGN KEY (teacher_titles.title_id) | - | 职称ID（外键） |
| hire_date | DATE | NOT NULL | - | 入职日期 |
| office_location | VARCHAR(50) | - | - | 办公室位置 |
| teacher_no | VARCHAR(20) | UNIQUE, NOT NULL | - | 教师编号（全局唯一） |
| status_id | INT | NOT NULL, DEFAULT 1, FOREIGN KEY (teacher_statuses.status_id) | 1 | 教师状态（外键） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| created_by | INT | FOREIGN KEY (users.user_id) | - | 创建人ID |
| updated_by | INT | FOREIGN KEY (users.user_id) | - | 更新人ID |

**索引**:
- idx_teacher_no (teacher_no)
- idx_department_id (department_id)
- idx_status_id (status_id)
- idx_teachers_department_status (department_id, status_id)

**约束**:
- chk_hire_date: hire_date >= '2000-01-01'

#### 3.3.2 学生表 (students)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| student_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 学生ID（主键） |
| user_id | INT | UNIQUE, NOT NULL, FOREIGN KEY (users.user_id) | - | 用户ID（外键） |
| department_id | INT | NOT NULL, FOREIGN KEY (departments.department_id) | - | 学院ID（外键） |
| major_id | INT | NOT NULL, FOREIGN KEY (majors.major_id) | - | 专业ID（外键） |
| class_id | INT | NOT NULL, FOREIGN KEY (class_info.class_id) | - | 班级ID（外键） |
| enrollment_date | DATE | NOT NULL | - | 入学日期 |
| education_years | TINYINT UNSIGNED | NOT NULL | 4 | 学制（年） |
| student_no | VARCHAR(20) | UNIQUE, NOT NULL | - | 学号（全局唯一） |
| status_id | INT | NOT NULL, DEFAULT 1, FOREIGN KEY (student_statuses.status_id) | 1 | 学生状态（外键） |
| emergency_contact | VARCHAR(50) | - | - | 紧急联系人姓名 |
| emergency_phone | VARCHAR(20) | - | - | 紧急联系人电话 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| created_by | INT | FOREIGN KEY (users.user_id) | - | 创建人ID |
| updated_by | INT | FOREIGN KEY (users.user_id) | - | 更新人ID |

**索引**:
- idx_student_no (student_no)
- idx_enrollment_date (enrollment_date)
- idx_class_id (class_id)
- idx_status_id (status_id)
- idx_students_class_status (class_id, status_id)

**约束**:
- chk_education_years: education_years BETWEEN 1 AND 8
- chk_enrollment_date: enrollment_date >= '2000-01-01'

### 3.4 教学管理表

#### 3.4.1 课程表 (courses)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| course_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 课程ID（主键） |
| course_code | VARCHAR(20) | UNIQUE, NOT NULL | - | 课程代码（全局唯一） |
| course_name | VARCHAR(100) | NOT NULL | - | 课程名称 |
| course_description | TEXT | - | - | 课程描述 |
| department_id | INT | NOT NULL, FOREIGN KEY (departments.department_id) | - | 所属学院ID（外键） |
| credit | DECIMAL(4,1) | NOT NULL | - | 学分（必须大于0） |
| course_hours | SMALLINT UNSIGNED | NOT NULL | - | 课时（必须大于0） |
| course_type | ENUM('COMPULSORY', 'ELECTIVE') | NOT NULL | - | 课程类型（必修/选修） |
| exam_type | ENUM('CLOSED_BOOK', 'OPEN_BOOK', 'REPORT', 'PRACTICAL') | NOT NULL | - | 考试类型 |
| created_by | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 创建人ID（外键） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_course_name (course_name)
- idx_department_id (department_id)
- idx_course_type (course_type)

**约束**:
- chk_credit: credit > 0
- chk_course_hours: course_hours > 0

#### 3.4.2 学期表 (semesters)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| semester_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 学期ID（主键） |
| academic_year | VARCHAR(9) | NOT NULL | - | 学年（如2023-2024） |
| semester_name | VARCHAR(20) | NOT NULL | - | 学期名称 |
| start_date | DATE | NOT NULL | - | 开始日期 |
| end_date | DATE | NOT NULL | - | 结束日期 |
| course_selection_start | DATE | NOT NULL | - | 选课开始日期 |
| course_selection_end | DATE | NOT NULL | - | 选课结束日期 |
| grade_entry_start | DATE | NOT NULL | - | 成绩录入开始日期 |
| grade_entry_end | DATE | NOT NULL | - | 成绩录入结束日期 |
| is_current | TINYINT(1) | - | 0 | 是否当前学期（0-否，1-是） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_academic_year (academic_year)
- idx_is_current (is_current)
- idx_dates (start_date, end_date)

**约束**:
- chk_end_date: end_date > start_date
- chk_selection_dates: course_selection_end > course_selection_start
- chk_grade_dates: grade_entry_end > grade_entry_start
- chk_is_current: is_current IN (0, 1)

#### 3.4.3 教师授课表 (teaching_assignments)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| assignment_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 授课ID（主键） |
| teacher_id | INT | NOT NULL, FOREIGN KEY (teachers.teacher_id) | - | 教师ID（外键） |
| course_id | INT | NOT NULL, FOREIGN KEY (courses.course_id) | - | 课程ID（外键） |
| semester_id | INT | NOT NULL, FOREIGN KEY (semesters.semester_id) | - | 学期ID（外键） |
| classroom | VARCHAR(50) | - | - | 教室 |
| schedule_info | JSON | - | - | 上课时间安排（JSON格式存储详细时间） |
| max_students | INT | NOT NULL | 50 | 最大学生数 |
| current_students | INT | NOT NULL | 0 | 当前学生数 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- uk_teacher_course_semester (teacher_id, course_id, semester_id) - 唯一索引
- idx_teacher_course (teacher_id, course_id)
- idx_semester_course (semester_id, course_id)
- idx_teacher_semester (teacher_id, semester_id)

**约束**:
- chk_max_students: max_students > 0
- chk_current_students: current_students >= 0
- chk_student_capacity: current_students <= max_students

#### 3.4.4 学生选课表 (course_selections)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| selection_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 选课ID（主键） |
| student_id | INT | NOT NULL, FOREIGN KEY (students.student_id) | - | 学生ID（外键） |
| assignment_id | INT | NOT NULL, FOREIGN KEY (teaching_assignments.assignment_id) | - | 授课ID（外键） |
| selection_time | TIMESTAMP | - | CURRENT_TIMESTAMP | 选课时间 |
| status | ENUM('SELECTED', 'DROPPED', 'COMPLETED') | - | 'SELECTED' | 选课状态 |
| dropped_time | TIMESTAMP | NULL | - | 退课时间 |
| completed_time | TIMESTAMP | NULL | - | 完成时间 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- uk_student_assignment_active (student_id, assignment_id, status) - 唯一索引
- uk_student_course_semester (student_id, assignment_id) - 唯一索引
- idx_student_id (student_id)
- idx_assignment_id (assignment_id)
- idx_status (status)
- idx_selection_time (selection_time)

**约束**:
- chk_status_flow: 
  - (status = 'SELECTED' AND dropped_time IS NULL AND completed_time IS NULL) OR
  - (status = 'DROPPED' AND dropped_time IS NOT NULL) OR
  - (status = 'COMPLETED' AND completed_time IS NOT NULL)

#### 3.4.5 成绩表 (course_grades)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| grade_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 成绩ID（主键） |
| student_id | INT | NOT NULL, FOREIGN KEY (students.student_id) | - | 学生ID（外键） |
| assignment_id | INT | NOT NULL, FOREIGN KEY (teaching_assignments.assignment_id) | - | 授课ID（外键） |
| usual_score | DECIMAL(5,2) | - | - | 平时成绩（0-100） |
| final_grade | DECIMAL(5,2) | - | - | 期末成绩（0-100） |
| total_grade | DECIMAL(5,2) | GENERATED ALWAYS AS (COALESCE(usual_score * 0.3, 0) + COALESCE(final_grade * 0.7, 0)) STORED | - | 总评成绩（计算列） |
| gpa_grade | DECIMAL(3,2) | - | - | 绩点（0-4.0） |
| review_status_id | INT | NOT NULL, DEFAULT 1, FOREIGN KEY (grade_review_statuses.status_id) | 1 | 审核状态（外键） |
| review_time | TIMESTAMP | NULL | - | 审核时间 |
| reviewer_id | INT | FOREIGN KEY (users.user_id) | - | 审核人ID（外键） |
| review_comment | TEXT | - | - | 审核意见 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- uk_student_assignment_grade (student_id, assignment_id) - 唯一索引
- idx_student_grade (student_id)
- idx_assignment_grade (assignment_id)
- idx_review_status (review_status_id)
- idx_grades_student_semester (student_id, assignment_id)

**约束**:
- chk_usual_score_range: usual_score IS NULL OR (usual_score >= 0 AND usual_score <= 100)
- chk_final_grade_range: final_grade IS NULL OR (final_grade >= 0 AND final_grade <= 100)
- chk_gpa_grade_range: gpa_grade IS NULL OR (gpa_grade >= 0 AND gpa_grade <= 4.0)
- chk_grade_consistency: 
  - (usual_score IS NULL AND final_grade IS NULL) OR
  - (usual_score IS NOT NULL AND final_grade IS NOT NULL)

#### 3.4.6 课程先修关系表 (course_prerequisites)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| course_id | INT | PRIMARY KEY, FOREIGN KEY (courses.course_id) | - | 课程ID（外键） |
| prerequisite_course_id | INT | PRIMARY KEY, FOREIGN KEY (courses.course_id) | - | 先修课程ID（外键） |
| is_mandatory | BOOLEAN | - | TRUE | 是否强制先修 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |

### 3.5 图书管理表

#### 3.5.1 图书表 (books)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| book_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 图书ID（主键） |
| isbn | VARCHAR(20) | UNIQUE, NOT NULL | - | 国际标准书号（ISBN） |
| book_title | VARCHAR(255) | NOT NULL | - | 书名 |
| author | VARCHAR(100) | NOT NULL | - | 作者 |
| publisher | VARCHAR(100) | NOT NULL | - | 出版社 |
| publish_year | INT | - | - | 出版年份 |
| category_id | INT | NOT NULL, FOREIGN KEY (book_categories.category_id) | - | 图书分类ID（外键） |
| location | VARCHAR(50) | NOT NULL | - | 馆藏位置 |
| total_copies | INT | NOT NULL | 1 | 总册数 |
| available_copies | INT | NOT NULL | 1 | 可借册数 |
| created_by | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 创建人ID（外键） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_book_title (book_title)
- idx_author (author)
- idx_category_id (category_id)
- idx_available_copies (available_copies)

**约束**:
- chk_publish_year: publish_year IS NULL OR publish_year > 1800
- chk_total_copies: total_copies > 0
- chk_available_copies: available_copies >= 0
- chk_available_vs_total: available_copies <= total_copies

#### 3.5.2 图书预约表 (book_reservations)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| reservation_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 预约记录ID（主键） |
| user_id | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 预约用户ID（外键） |
| book_id | INT | NOT NULL, FOREIGN KEY (books.book_id) | - | 图书ID（外键） |
| reservation_time | TIMESTAMP | - | CURRENT_TIMESTAMP | 预约时间 |
| expiry_time | TIMESTAMP | NOT NULL | - | 预约过期时间 |
| status | ENUM('PENDING', 'FULFILLED', 'CANCELLED', 'EXPIRED') | - | 'PENDING' | 预约状态 |
| fulfilled_time | TIMESTAMP | NULL | - | 预约实现时间 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- uk_pending_reservation (user_id, book_id, status) - 唯一索引
- idx_user_id (user_id)
- idx_book_id (book_id)
- idx_status (status)
- idx_expiry_time (expiry_time)

#### 3.5.3 图书借阅表 (book_borrowings)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| borrowing_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 借阅记录ID（主键） |
| user_id | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 借阅用户ID（外键） |
| book_id | INT | NOT NULL, FOREIGN KEY (books.book_id) | - | 图书ID（外键） |
| borrow_date | DATE | NOT NULL | - | 借阅日期 |
| due_date | DATE | NOT NULL | - | 应归还日期 |
| return_date | DATE | - | - | 实际归还日期 |
| fine | DECIMAL(10,2) | - | 0 | 罚款金额 |
| status_id | INT | NOT NULL, DEFAULT 1, FOREIGN KEY (book_borrow_statuses.status_id) | 1 | 借阅状态（外键） |
| renew_count | TINYINT | - | 0 | 续借次数 |
| damage_status | ENUM('GOOD', 'MINOR_DAMAGE', 'MAJOR_DAMAGE', 'LOST') | - | 'GOOD' | 损坏状态 |
| compensation | DECIMAL(10,2) | - | 0 | 赔偿金额 |
| created_by | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 操作人ID（外键） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_user_id (user_id)
- idx_book_id (book_id)
- idx_due_date (due_date)
- idx_status_id (status_id)
- idx_return_date (return_date)
- idx_borrowings_user_status (user_id, status_id)

**约束**:
- chk_due_date: due_date > borrow_date
- chk_return_date: return_date IS NULL OR return_date >= borrow_date
- chk_fine: fine >= 0
- chk_renew_count: renew_count BETWEEN 0 AND 3
- chk_compensation: compensation >= 0

### 3.6 系统管理表

#### 3.6.1 系统配置表 (system_config)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| config_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 配置ID（主键） |
| config_key | VARCHAR(50) | UNIQUE, NOT NULL | - | 配置键（全局唯一） |
| config_value | VARCHAR(500) | NOT NULL | - | 配置值 |
| config_type | ENUM('STRING', 'NUMBER', 'BOOLEAN', 'JSON') | NOT NULL | 'STRING' | 配置类型 |
| description | VARCHAR(255) | - | - | 配置描述 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_config_key (config_key)

#### 3.6.2 系统操作日志表 (system_audit_log)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| log_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 日志ID（主键） |
| user_id | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 操作用户ID（外键） |
| action_type | VARCHAR(50) | NOT NULL | - | 操作类型 |
| table_name | VARCHAR(50) | - | - | 操作表名 |
| record_id | INT | - | - | 记录ID |
| old_values | JSON | - | - | 旧值 |
| new_values | JSON | - | - | 新值 |
| ip_address | VARCHAR(50) | - | - | 操作IP |
| user_agent | VARCHAR(500) | - | - | 用户代理 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 操作时间 |

**索引**:
- idx_user_id (user_id)
- idx_action_type (action_type)
- idx_created_at (created_at)
- idx_table_record (table_name, record_id)

#### 3.6.3 ID变更表 (id_changes)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| change_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 变更记录ID（主键） |
| table_name | VARCHAR(50) | NOT NULL | - | 变更的表名 |
| record_id | INT | NOT NULL | - | 记录ID |
| old_id | VARCHAR(50) | NOT NULL | - | 旧ID |
| new_id | VARCHAR(50) | NOT NULL | - | 新ID |
| changed_by | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 操作人ID（外键） |
| changed_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 变更时间 |
| reason | VARCHAR(255) | NOT NULL | - | 变更原因 |

**索引**:
- idx_table_record (table_name, record_id)
- idx_changed_at (changed_at)

#### 3.6.4 选课冲突记录表 (course_schedule_conflicts)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| conflict_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 冲突ID（主键） |
| student_id | INT | NOT NULL, FOREIGN KEY (students.student_id) | - | 学生ID（外键） |
| assignment_id1 | INT | NOT NULL, FOREIGN KEY (teaching_assignments.assignment_id) | - | 课程安排1ID（外键） |
| assignment_id2 | INT | NOT NULL, FOREIGN KEY (teaching_assignments.assignment_id) | - | 课程安排2ID（外键） |
| conflict_type | ENUM('TIME', 'PREREQUISITE', 'CAPACITY') | NOT NULL | - | 冲突类型 |
| conflict_details | JSON | - | - | 冲突详情 |
| detected_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 检测时间 |
| resolved_at | TIMESTAMP | NULL | - | 解决时间 |

**索引**:
- idx_student_id (student_id)
- idx_detected_at (detected_at)

### 3.7 辅助功能表

#### 3.7.1 待办事项表 (todos)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 待办事项ID，主键，自增 |
| user_id | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 用户ID，关联用户表 |
| text | VARCHAR(500) | NOT NULL | - | 待办事项内容 |
| completed | BOOLEAN | - | FALSE | 完成状态 |
| due_date | DATE | - | - | 截止日期 |
| important | BOOLEAN | - | FALSE | 是否重要 |
| category | VARCHAR(50) | - | - | 分类 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_user_id (user_id)
- idx_completed (completed)
- idx_due_date (due_date)
- idx_important (important)

#### 3.7.2 公告表 (announcements)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 公告ID，主键，自增 |
| title | VARCHAR(200) | NOT NULL | - | 公告标题 |
| content | TEXT | NOT NULL | - | 公告内容 |
| publish_date | DATE | NOT NULL | - | 发布日期 |
| expiry_date | DATE | - | - | 过期日期 |
| department_id | INT | FOREIGN KEY (departments.department_id) | - | 发布部门ID（外键） |
| announcement_type | ENUM('IMPORTANT', 'NOTICE', 'ACTIVITY', 'INFO') | - | 'NOTICE' | 公告类型 |
| priority | ENUM('LOW', 'MEDIUM', 'HIGH', 'URGENT') | - | 'MEDIUM' | 优先级 |
| created_by | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 发布人ID（外键） |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_publish_date (publish_date)
- idx_type (announcement_type)
- idx_priority (priority)
- idx_department_id (department_id)

**约束**:
- chk_expiry_date: expiry_date IS NULL OR expiry_date >= publish_date

#### 3.7.3 用户地址表 (user_addresses)

| 字段名 | 数据类型 | 约束 | 默认值 | 描述 |
|--------|----------|------|--------|------|
| address_id | INT | PRIMARY KEY, AUTO_INCREMENT | - | 地址ID（主键） |
| user_id | INT | NOT NULL, FOREIGN KEY (users.user_id) | - | 用户ID（外键） |
| address_type | ENUM('HOME', 'SCHOOL', 'WORK') | - | 'HOME' | 地址类型 |
| province | VARCHAR(50) | - | - | 省份 |
| city | VARCHAR(50) | - | - | 城市 |
| district | VARCHAR(50) | - | - | 区县 |
| detail_address | VARCHAR(255) | - | - | 详细地址 |
| is_primary | BOOLEAN | - | FALSE | 是否主要地址 |
| created_at | TIMESTAMP | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- idx_user_id (user_id)
- idx_address_type (address_type)

## 4. 视图设计

### 4.1 学生学术统计视图 (student_academic_stats)

```sql
CREATE OR REPLACE VIEW student_academic_stats AS
SELECT
    s.student_id,
    s.student_no,
    u.username,
    d.department_name,
    m.major_name,
    ci.class_name,
    ss.status_name AS student_status,
    s.enrollment_date,
    s.education_years
FROM
    students s
        JOIN
    users u ON s.user_id = u.user_id
        JOIN
    departments d ON s.department_id = d.department_id
        JOIN
    majors m ON s.major_id = m.major_id
        JOIN
    class_info ci ON s.class_id = ci.class_id
        JOIN
    student_statuses ss ON s.status_id = ss.status_id;
```

### 4.2 课程统计视图 (course_statistics)

```sql
CREATE OR REPLACE VIEW course_statistics AS
SELECT
    c.course_id,
    c.course_code,
    c.course_name,
    d.department_name,
    s.semester_id,
    s.academic_year,
    s.semester_name,
    COUNT(DISTINCT cg.student_id) AS total_students,
    AVG(cg.final_grade) AS avg_final_grade,
    AVG(cg.total_grade) AS avg_total_grade,
    MIN(cg.final_grade) AS min_final_grade,
    MAX(cg.final_grade) AS max_final_grade,
    COUNT(CASE WHEN cg.final_grade >= 60 THEN 1 END) AS passed_students,
    COUNT(CASE WHEN cg.final_grade < 60 THEN 1 END) AS failed_students
FROM
    courses c
        JOIN
    departments d ON c.department_id = d.department_id
        JOIN
    teaching_assignments ta ON c.course_id = ta.course_id
        JOIN
    semesters s ON ta.semester_id = s.semester_id
        LEFT JOIN
    course_grades cg ON ta.assignment_id = cg.assignment_id
WHERE
    cg.review_status_id = 2  -- 仅包含已审核通过的成绩
GROUP BY
    c.course_id, c.course_code, c.course_name, d.department_name,
    s.semester_id, s.academic_year, s.semester_name;
```

### 4.3 教师授课统计视图 (teacher_course_stats)

```sql
CREATE OR REPLACE VIEW teacher_course_stats AS
SELECT
    t.teacher_id,
    t.teacher_no,
    u.username,
    d.department_name,
    tt.title_name,
    ts.status_name AS teacher_status,
    COUNT(ta.assignment_id) AS total_assignments,
    SUM(ta.current_students) AS total_students,
    AVG(ta.current_students) AS avg_students_per_course,
    MIN(ta.current_students) AS min_students,
    MAX(ta.current_students) AS max_students
FROM
    teachers t
        JOIN
    users u ON t.user_id = u.user_id
        JOIN
    departments d ON t.department_id = d.department_id
        JOIN
    teacher_titles tt ON t.title_id = tt.title_id
        JOIN
    teacher_statuses ts ON t.status_id = ts.status_id
        LEFT JOIN
    teaching_assignments ta ON t.teacher_id = ta.teacher_id
GROUP BY
    t.teacher_id, t.teacher_no, u.username, d.department_name,
    tt.title_name, ts.status_name;
```

### 4.4 图书借阅统计视图 (book_borrowing_stats)

```sql
CREATE OR REPLACE VIEW book_borrowing_stats AS
SELECT
    b.book_id,
    b.isbn,
    b.book_title,
    b.author,
    bc.category_name,
    b.total_copies,
    b.available_copies,
    COUNT(bb.borrowing_id) AS total_borrowings,
    COUNT(CASE WHEN bb.return_date IS NULL THEN 1 END) AS current_borrowings,
    AVG(DATEDIFF(bb.return_date, bb.borrow_date)) AS avg_borrow_days
FROM
    books b
        JOIN
    book_categories bc ON b.category_id = bc.category_id
        LEFT JOIN
    book_borrowings bb ON b.book_id = bb.book_id
GROUP BY
    b.book_id, b.isbn, b.book_title, b.author, bc.category_name,
    b.total_copies, b.available_copies;
```

## 5. 索引设计

### 5.1 主键索引
所有表均使用自增整数作为主键，自动创建聚簇索引。

### 5.2 唯一索引
- users.username, users.email, users.phone, users.external_id
- roles.role_name
- permissions.permission_name
- student_statuses.status_name
- teacher_statuses.status_name
- teacher_titles.title_name
- grade_review_statuses.status_name
- book_borrow_statuses.status_name
- book_categories.category_name
- departments.department_name, departments.department_code
- majors.major_code
- class_info.class_name
- teachers.teacher_no, teachers.user_id
- students.student_no, students.user_id
- courses.course_code
- teaching_assignments.uk_teacher_course_semester (teacher_id, course_id, semester_id)
- course_selections.uk_student_assignment_active (student_id, assignment_id, status)
- course_selections.uk_student_course_semester (student_id, assignment_id)
- course_grades.uk_student_assignment_grade (student_id, assignment_id)
- books.isbn
- book_reservations.uk_pending_reservation (user_id, book_id, status)
- system_config.config_key

### 5.3 普通索引
- users.idx_status
- roles.idx_role_name
- user_roles.idx_user_id, user_roles.idx_role_id
- permissions.idx_module
- student_statuses.idx_status_name
- teacher_statuses.idx_status_name
- teacher_titles.idx_title_name, teacher_titles.idx_title_level
- grade_review_statuses.idx_status_name
- book_borrow_statuses.idx_status_name
- book_categories.idx_parent_id
- departments.idx_department_code
- majors.idx_major_code, majors.idx_department_id
- class_info.idx_class_name, class_info.idx_major_id, class_info.idx_enrollment_year
- teachers.idx_teacher_no, teachers.idx_department_id, teachers.idx_status_id, teachers.idx_teachers_department_status
- students.idx_student_no, students.idx_enrollment_date, students.idx_class_id, students.idx_status_id, students.idx_students_class_status
- courses.idx_course_name, courses.idx_department_id, courses.idx_course_type
- semesters.idx_academic_year, semesters.idx_is_current, semesters.idx_dates
- teaching_assignments.idx_teacher_course, teaching_assignments.idx_semester_course, teaching_assignments.idx_teacher_semester
- course_selections.idx_student_id, course_selections.idx_assignment_id, course_selections.idx_status, course_selections.idx_selection_time
- course_grades.idx_student_grade, course_grades.idx_assignment_grade, course_grades.idx_review_status, course_grades.idx_grades_student_semester
- books.idx_book_title, books.idx_author, books.idx_category_id, books.idx_available_copies
- book_reservations.idx_user_id, book_reservations.idx_book_id, book_reservations.idx_status, book_reservations.idx_expiry_time
- book_borrowings.idx_user_id, book_borrowings.idx_book_id, book_borrowings.idx_due_date, book_borrowings.idx_status_id, book_borrowings.idx_return_date, book_borrowings.idx_borrowings_user_status
- system_config.idx_config_key
- system_audit_log.idx_user_id, system_audit_log.idx_action_type, system_audit_log.idx_created_at, system_audit_log.idx_table_record
- id_changes.idx_table_record, id_changes.idx_changed_at
- course_schedule_conflicts.idx_student_id, course_schedule_conflicts.idx_detected_at
- todos.idx_user_id, todos.idx_completed, todos.idx_due_date, todos.idx_important
- announcements.idx_publish_date, announcements.idx_type, announcements.idx_priority, announcements.idx_department_id
- user_addresses.idx_user_id, user_addresses.idx_address_type

## 6. 数据完整性约束

### 6.1 实体完整性
- 所有表都有主键约束，确保每行记录唯一性
- 使用自增整数作为主键，避免业务逻辑变化影响主键

### 6.2 参照完整性
- 使用外键约束确保关联表之间的数据一致性
- 设置适当的级联操作（CASCADE、SET NULL、RESTRICT）
- 重要外键关系：
  - users表与students、teachers表的一对一关系
  - departments表与majors表的一对多关系
  - majors表与class_info表的一对多关系
  - class_info表与students表的一对多关系
  - courses表与teaching_assignments表的一对多关系
  - teaching_assignments表与course_selections表的一对多关系
  - teaching_assignments表与course_grades表的一对多关系
  - books表与book_borrowings表的一对多关系

### 6.3 域完整性
- 使用NOT NULL约束确保必填字段不为空
- 使用CHECK约束确保字段值在合理范围内
- 使用DEFAULT约束为字段提供默认值
- 使用ENUM类型限制字段取值范围

### 6.4 用户自定义完整性
- 使用唯一约束确保关键字段不重复
- 使用触发器实现复杂的业务规则（如学号生成规则）
- 使用存储过程封装复杂业务逻辑

## 7. 安全性设计

### 7.1 用户认证与授权
- 基于角色的访问控制(RBAC)模型
- 用户密码使用哈希加密存储
- 细粒度的权限控制，精确到具体操作

### 7.2 数据安全
- 敏感数据加密存储
- 重要操作记录审计日志
- 定期数据备份策略

### 7.3 SQL注入防护
- 使用参数化查询
- 输入数据验证和过滤
- 最小权限原则

## 8. 性能优化

### 8.1 查询优化
- 合理设计索引，提高查询效率
- 避免全表扫描，使用索引覆盖查询
- 使用视图简化复杂查询

### 8.2 数据库结构优化
- 遵循数据库设计范式，减少数据冗余
- 合理使用数据类型，减少存储空间
- 表分区策略（针对大数据量表）

### 8.3 系统优化
- 数据库连接池管理
- 查询缓存机制
- 定期维护和优化表结构

## 9. 扩展性设计

### 9.1 水平扩展
- 支持数据库分片
- 读写分离架构
- 负载均衡策略

### 9.2 垂直扩展
- 模块化设计，便于功能扩展
- 预留扩展字段
- 灵活的配置管理

## 10. 数据初始化

### 10.1 基础数据初始化
- 系统配置参数
- 角色和权限数据
- 字典表数据（状态、职称等）

### 10.2 示例数据
- 学院、专业、班级数据
- 用户、教师、学生数据
- 课程、授课、选课数据
- 图书相关数据

## 11. 备份与恢复策略

### 11.1 备份策略
- 定期全量备份
- 增量备份策略
- 重要表实时备份

### 11.2 恢复策略
- 灾难恢复计划
- 数据一致性检查
- 回滚机制

## 12. 版本控制与变更管理

### 12.1 数据库版本控制
- 使用迁移脚本管理数据库变更
- 版本号管理策略
- 变更记录文档

### 12.2 变更管理流程
- 变更申请与审批
- 测试环境验证
- 生产环境部署
- 回滚预案

## 13. 总结

本数据库设计文档详细描述了Lucky SMS学生管理系统的数据库架构、表结构、索引设计、关系约束等方面。设计遵循了数据库设计的最佳实践，确保了数据的完整性、一致性和安全性，同时考虑了系统的性能和可扩展性。

通过合理的表结构设计和索引优化，系统能够高效地处理各种业务场景下的数据操作。基于角色的权限控制模型确保了系统的安全性，而完善的审计日志机制则提供了操作追溯能力。

该设计为系统的稳定运行和未来扩展提供了坚实的基础。