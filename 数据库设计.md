# Lucky_SMS 数据库设计文档

## 1. 数据库概述

Lucky_SMS（学生管理系统）数据库采用MySQL 8.0+，使用utf8mb4字符集和utf8mb4_unicode_ci排序规则，支持完整的Unicode字符集。数据库引擎统一使用InnoDB，提供事务支持和外键约束。

**数据库特性：**
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci
- 存储引擎：InnoDB
- 支持事务和外键约束
- 完整的索引优化

## 2. 数据库表结构

### 2.1 基础字典表

#### 2.1.1 用户表 (users)
存储系统所有用户的基础信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| user_id | INT | PRIMARY KEY, AUTO_INCREMENT | 用户ID（主键） |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名（全局唯一） |
| password_hash | VARCHAR(255) | NOT NULL | 加密后的密码 |
| email | VARCHAR(100) | UNIQUE | 电子邮箱 |
| phone | VARCHAR(20) | UNIQUE, NOT NULL | 手机号码 |
| gender | ENUM('M', 'F', 'O') | DEFAULT 'O' | 性别 |
| birth_date | DATE | CHECK约束 | 出生日期 |
| avatar_url | VARCHAR(255) | - | 头像URL |
| external_id | VARCHAR(50) | UNIQUE | 外部系统ID |
| status | ENUM('ACTIVE', 'INACTIVE') | DEFAULT 'ACTIVE' | 用户状态 |
| last_login_time | TIMESTAMP | NULL | 最后登录时间 |
| last_login_ip | VARCHAR(50) | - | 最后登录IP |
| last_password_change_time | TIMESTAMP | NULL | 密码最后修改时间 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| created_by | INT | FOREIGN KEY | 创建人ID |
| updated_by | INT | FOREIGN KEY | 更新人ID |

**索引：** idx_username, idx_email, idx_phone, idx_status

#### 2.1.2 角色表 (roles)
定义系统中的不同角色。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| role_id | INT | PRIMARY KEY, AUTO_INCREMENT | 角色ID（主键） |
| role_name | VARCHAR(50) | UNIQUE, NOT NULL | 角色名称（全局唯一） |
| description | VARCHAR(255) | - | 角色描述 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_role_name

#### 2.1.3 权限表 (permissions)
定义系统中的各种操作权限。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| permission_id | INT | PRIMARY KEY, AUTO_INCREMENT | 权限ID（主键） |
| permission_name | VARCHAR(50) | UNIQUE, NOT NULL | 权限名称（全局唯一） |
| description | VARCHAR(255) | - | 权限描述 |
| module | VARCHAR(50) | NOT NULL | 所属功能模块 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_permission_name, idx_module

#### 2.1.4 状态字典表

- **学生状态表 (student_statuses)**：定义学生状态（在读、毕业、休学等）
- **教师状态表 (teacher_statuses)**：定义教师状态（在职、休假、退休等）
- **成绩审核状态表 (grade_review_statuses)**：定义成绩审核状态
- **图书借阅状态表 (book_borrow_statuses)**：定义图书借阅状态
- **教师职称表 (teacher_titles)**：定义教师职称及级别
- **图书分类表 (book_categories)**：定义图书分类层级结构

### 2.2 基础业务表

#### 2.2.1 学院表 (departments)
定义学校学院及负责人。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| department_id | INT | PRIMARY KEY, AUTO_INCREMENT | 学院ID（主键） |
| department_name | VARCHAR(50) | UNIQUE, NOT NULL | 学院名称（全局唯一） |
| department_code | VARCHAR(10) | UNIQUE, NOT NULL | 学院代码（全局唯一） |
| dean_id | INT | FOREIGN KEY | 院长ID（关联教师表） |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_department_code

#### 2.2.2 专业表 (majors)
定义学院下的专业。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| major_id | INT | PRIMARY KEY, AUTO_INCREMENT | 专业ID（主键） |
| major_name | VARCHAR(50) | NOT NULL | 专业名称 |
| department_id | INT | FOREIGN KEY, NOT NULL | 所属学院ID |
| major_code | VARCHAR(10) | UNIQUE, NOT NULL | 专业代码（全局唯一） |
| required_credits | DECIMAL(5,2) | DEFAULT 0.00, CHECK约束 | 应修学分 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_major_code, idx_department_id

#### 2.2.3 班级表 (class_info)
定义专业下的班级信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| class_id | INT | PRIMARY KEY, AUTO_INCREMENT | 班级ID（主键） |
| class_name | VARCHAR(50) | UNIQUE, NOT NULL | 班级名称（全局唯一） |
| major_id | INT | FOREIGN KEY, NOT NULL | 所属专业ID |
| enrollment_year | YEAR | NOT NULL, CHECK约束 | 入学年份 |
| class_advisor_id | INT | FOREIGN KEY | 班主任ID |
| classroom | VARCHAR(50) | - | 固定教室 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_class_name, idx_major_id, idx_enrollment_year

### 2.3 关联关系表

#### 2.3.1 用户角色关联表 (user_roles)
记录用户与角色的对应关系。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| user_id | INT | FOREIGN KEY, NOT NULL | 用户ID |
| role_id | INT | FOREIGN KEY, NOT NULL | 角色ID |
| assigned_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 分配时间 |
| assigned_by | INT | FOREIGN KEY | 分配人ID |

**主键：** (user_id, role_id)
**索引：** idx_user_id, idx_role_id

#### 2.3.2 角色权限关联表 (role_permissions)
记录角色与权限的对应关系。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| role_id | INT | FOREIGN KEY, NOT NULL | 角色ID |
| permission_id | INT | FOREIGN KEY, NOT NULL | 权限ID |
| assigned_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 分配时间 |
| assigned_by | INT | FOREIGN KEY | 分配人ID |

**主键：** (role_id, permission_id)
**索引：** idx_role_id, idx_permission_id

### 2.4 核心业务表

#### 2.4.1 教师表 (teachers)
存储教师详细信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| teacher_id | INT | PRIMARY KEY, AUTO_INCREMENT | 教师ID（主键） |
| user_id | INT | FOREIGN KEY, UNIQUE, NOT NULL | 用户ID |
| department_id | INT | FOREIGN KEY, NOT NULL | 学院ID |
| title_id | INT | FOREIGN KEY, NOT NULL | 职称ID |
| hire_date | DATE | NOT NULL, CHECK约束 | 入职日期 |
| office_location | VARCHAR(50) | - | 办公室位置 |
| teacher_no | VARCHAR(20) | UNIQUE, NOT NULL | 教师编号（全局唯一） |
| status_id | INT | FOREIGN KEY, DEFAULT 1 | 教师状态 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| created_by | INT | FOREIGN KEY | 创建人ID |
| updated_by | INT | FOREIGN KEY | 更新人ID |

**索引：** idx_teacher_no, idx_department_id, idx_status_id, idx_teachers_department_status

#### 2.4.2 学生表 (students)
存储学生详细信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| student_id | INT | PRIMARY KEY, AUTO_INCREMENT | 学生ID（主键） |
| user_id | INT | FOREIGN KEY, UNIQUE, NOT NULL | 用户ID |
| department_id | INT | FOREIGN KEY, NOT NULL | 学院ID |
| major_id | INT | FOREIGN KEY, NOT NULL | 专业ID |
| class_id | INT | FOREIGN KEY, NOT NULL | 班级ID |
| enrollment_date | DATE | NOT NULL, CHECK约束 | 入学日期 |
| education_years | TINYINT UNSIGNED | DEFAULT 4, CHECK约束 | 学制（年） |
| student_no | VARCHAR(20) | UNIQUE, NOT NULL | 学号（全局唯一） |
| status_id | INT | FOREIGN KEY, DEFAULT 1 | 学生状态 |
| emergency_contact | VARCHAR(50) | - | 紧急联系人姓名 |
| emergency_phone | VARCHAR(20) | - | 紧急联系人电话 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| created_by | INT | FOREIGN KEY | 创建人ID |
| updated_by | INT | FOREIGN KEY | 更新人ID |

**索引：** idx_student_no, idx_enrollment_date, idx_class_id, idx_status_id, idx_students_class_status

#### 2.4.3 课程表 (courses)
存储课程基本信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| course_id | INT | PRIMARY KEY, AUTO_INCREMENT | 课程ID（主键） |
| course_code | VARCHAR(20) | UNIQUE, NOT NULL | 课程代码（全局唯一） |
| course_name | VARCHAR(100) | NOT NULL | 课程名称 |
| course_description | TEXT | - | 课程描述 |
| department_id | INT | FOREIGN KEY, NOT NULL | 所属学院ID |
| credit | DECIMAL(4,1) | NOT NULL, CHECK约束 | 学分 |
| course_hours | SMALLINT UNSIGNED | NOT NULL, CHECK约束 | 课时 |
| course_type | ENUM('COMPULSORY', 'ELECTIVE') | NOT NULL | 课程类型 |
| exam_type | ENUM('CLOSED_BOOK', 'OPEN_BOOK', 'REPORT', 'PRACTICAL') | NOT NULL | 考试类型 |
| created_by | INT | FOREIGN KEY, NOT NULL | 创建人ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_course_name, idx_department_id, idx_course_type

#### 2.4.4 学期表 (semesters)
定义学期信息及时间窗口。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| semester_id | INT | PRIMARY KEY, AUTO_INCREMENT | 学期ID（主键） |
| academic_year | VARCHAR(9) | NOT NULL | 学年 |
| semester_name | VARCHAR(20) | NOT NULL | 学期名称 |
| start_date | DATE | NOT NULL | 开始日期 |
| end_date | DATE | NOT NULL, CHECK约束 | 结束日期 |
| course_selection_start | DATE | NOT NULL | 选课开始日期 |
| course_selection_end | DATE | NOT NULL, CHECK约束 | 选课结束日期 |
| grade_entry_start | DATE | NOT NULL | 成绩录入开始日期 |
| grade_entry_end | DATE | NOT NULL, CHECK约束 | 成绩录入结束日期 |
| is_current | TINYINT(1) | DEFAULT 0, CHECK约束 | 是否当前学期 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_academic_year, idx_is_current, idx_dates

### 2.5 教学管理表

#### 2.5.1 教师授课表 (teaching_assignments)
记录教师授课安排。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| assignment_id | INT | PRIMARY KEY, AUTO_INCREMENT | 授课ID（主键） |
| teacher_id | INT | FOREIGN KEY, NOT NULL | 教师ID |
| course_id | INT | FOREIGN KEY, NOT NULL | 课程ID |
| semester_id | INT | FOREIGN KEY, NOT NULL | 学期ID |
| classroom | VARCHAR(50) | - | 教室 |
| schedule_info | JSON | - | 上课时间安排 |
| max_students | INT | DEFAULT 50, CHECK约束 | 最大学生数 |
| current_students | INT | DEFAULT 0, CHECK约束 | 当前学生数 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**唯一约束：** uk_teacher_course_semester (teacher_id, course_id, semester_id)
**索引：** idx_teacher_course, idx_semester_course, idx_teacher_semester

#### 2.5.2 学生选课表 (course_selections)
记录学生选课信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| selection_id | INT | PRIMARY KEY, AUTO_INCREMENT | 选课ID（主键） |
| student_id | INT | FOREIGN KEY, NOT NULL | 学生ID |
| assignment_id | INT | FOREIGN KEY, NOT NULL | 授课ID |
| selection_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 选课时间 |
| status | ENUM('SELECTED', 'DROPPED', 'COMPLETED') | DEFAULT 'SELECTED' | 选课状态 |
| dropped_time | TIMESTAMP | NULL | 退课时间 |
| completed_time | TIMESTAMP | NULL | 完成时间 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**唯一约束：** uk_student_assignment_active (student_id, assignment_id, status)
**索引：** idx_student_id, idx_assignment_id, idx_status, idx_selection_time

#### 2.5.3 成绩表 (course_grades)
记录学生课程成绩。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| grade_id | INT | PRIMARY KEY, AUTO_INCREMENT | 成绩ID（主键） |
| student_id | INT | FOREIGN KEY, NOT NULL | 学生ID |
| assignment_id | INT | FOREIGN KEY, NOT NULL | 授课ID |
| usual_score | DECIMAL(5,2) | CHECK约束 | 平时成绩 |
| final_grade | DECIMAL(5,2) | CHECK约束 | 期末成绩 |
| total_grade | DECIMAL(5,2) | GENERATED COLUMN | 总评成绩 |
| gpa_grade | DECIMAL(3,2) | CHECK约束 | 绩点 |
| review_status_id | INT | FOREIGN KEY, DEFAULT 1 | 审核状态 |
| review_time | TIMESTAMP | NULL | 审核时间 |
| reviewer_id | INT | FOREIGN KEY | 审核人ID |
| review_comment | TEXT | - | 审核意见 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**唯一约束：** uk_student_assignment_grade (student_id, assignment_id)
**索引：** idx_student_grade, idx_assignment_grade, idx_review_status, idx_grades_student_semester

#### 2.5.4 课程先修关系表 (course_prerequisites)
定义课程先修关系。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| course_id | INT | FOREIGN KEY, NOT NULL | 课程ID |
| prerequisite_course_id | INT | FOREIGN KEY, NOT NULL | 先修课程ID |
| is_mandatory | BOOLEAN | DEFAULT TRUE | 是否强制先修 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

**主键：** (course_id, prerequisite_course_id)

### 2.6 图书馆管理表

#### 2.6.1 图书表 (books)
记录图书馆藏书信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| book_id | INT | PRIMARY KEY, AUTO_INCREMENT | 图书ID（主键） |
| isbn | VARCHAR(20) | UNIQUE, NOT NULL | 国际标准书号 |
| book_title | VARCHAR(255) | NOT NULL | 书名 |
| author | VARCHAR(100) | NOT NULL | 作者 |
| publisher | VARCHAR(100) | NOT NULL | 出版社 |
| publish_year | INT | CHECK约束 | 出版年份 |
| category_id | INT | FOREIGN KEY, NOT NULL | 图书分类ID |
| location | VARCHAR(50) | NOT NULL | 馆藏位置 |
| total_copies | INT | DEFAULT 1, CHECK约束 | 总册数 |
| available_copies | INT | DEFAULT 1, CHECK约束 | 可借册数 |
| created_by | INT | FOREIGN KEY, NOT NULL | 创建人ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_book_title, idx_author, idx_category_id, idx_available_copies

#### 2.6.2 图书预约表 (book_reservations)
记录图书预约信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| reservation_id | INT | PRIMARY KEY, AUTO_INCREMENT | 预约记录ID（主键） |
| user_id | INT | FOREIGN KEY, NOT NULL | 预约用户ID |
| book_id | INT | FOREIGN KEY, NOT NULL | 图书ID |
| reservation_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 预约时间 |
| expiry_time | TIMESTAMP | NOT NULL | 预约过期时间 |
| status | ENUM('PENDING', 'FULFILLED', 'CANCELLED', 'EXPIRED') | DEFAULT 'PENDING' | 预约状态 |
| fulfilled_time | TIMESTAMP | NULL | 预约实现时间 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**唯一约束：** uk_pending_reservation (user_id, book_id, status)
**索引：** idx_user_id, idx_book_id, idx_status, idx_expiry_time

#### 2.6.3 图书借阅表 (book_borrowings)
记录图书借阅信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| borrowing_id | INT | PRIMARY KEY, AUTO_INCREMENT | 借阅记录ID（主键） |
| user_id | INT | FOREIGN KEY, NOT NULL | 借阅用户ID |
| book_id | INT | FOREIGN KEY, NOT NULL | 图书ID |
| borrow_date | DATE | NOT NULL | 借阅日期 |
| due_date | DATE | NOT NULL, CHECK约束 | 应归还日期 |
| return_date | DATE | - | 实际归还日期 |
| fine | DECIMAL(10,2) | DEFAULT 0, CHECK约束 | 罚款金额 |
| status_id | INT | FOREIGN KEY, DEFAULT 1 | 借阅状态 |
| renew_count | TINYINT | DEFAULT 0, CHECK约束 | 续借次数 |
| damage_status | ENUM('GOOD', 'MINOR_DAMAGE', 'MAJOR_DAMAGE', 'LOST') | DEFAULT 'GOOD' | 损坏状态 |
| compensation | DECIMAL(10,2) | DEFAULT 0, CHECK约束 | 赔偿金额 |
| created_by | INT | FOREIGN KEY, NOT NULL | 操作人ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_user_id, idx_book_id, idx_due_date, idx_status_id, idx_return_date, idx_borrowings_user_status

### 2.7 系统管理表

#### 2.7.1 系统配置表 (system_config)
存储系统配置参数。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| config_id | INT | PRIMARY KEY, AUTO_INCREMENT | 配置ID（主键） |
| config_key | VARCHAR(50) | UNIQUE, NOT NULL | 配置键（全局唯一） |
| config_value | VARCHAR(500) | NOT NULL | 配置值 |
| config_type | ENUM('STRING', 'NUMBER', 'BOOLEAN', 'JSON') | DEFAULT 'STRING' | 配置类型 |
| description | VARCHAR(255) | - | 配置描述 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_config_key

#### 2.7.2 系统操作日志表 (system_audit_log)
记录重要操作日志。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| log_id | INT | PRIMARY KEY, AUTO_INCREMENT | 日志ID（主键） |
| user_id | INT | FOREIGN KEY, NOT NULL | 操作用户ID |
| action_type | VARCHAR(50) | NOT NULL | 操作类型 |
| table_name | VARCHAR(50) | - | 操作表名 |
| record_id | INT | - | 记录ID |
| old_values | JSON | - | 旧值 |
| new_values | JSON | - | 新值 |
| ip_address | VARCHAR(50) | - | 操作IP |
| user_agent | VARCHAR(500) | - | 用户代理 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 操作时间 |

**索引：** idx_user_id, idx_action_type, idx_created_at, idx_table_record

#### 2.7.3 ID变更表 (id_changes)
记录重要ID变更历史。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| change_id | INT | PRIMARY KEY, AUTO_INCREMENT | 变更记录ID（主键） |
| table_name | VARCHAR(50) | NOT NULL | 变更的表名 |
| record_id | INT | NOT NULL | 记录ID |
| old_id | VARCHAR(50) | NOT NULL | 旧ID |
| new_id | VARCHAR(50) | NOT NULL | 新ID |
| changed_by | INT | FOREIGN KEY, NOT NULL | 操作人ID |
| changed_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 变更时间 |
| reason | VARCHAR(255) | NOT NULL | 变更原因 |

**索引：** idx_table_record, idx_changed_at

### 2.8 辅助功能表

#### 2.8.1 选课冲突记录表 (course_schedule_conflicts)
记录选课冲突信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| conflict_id | INT | PRIMARY KEY, AUTO_INCREMENT | 冲突ID（主键） |
| student_id | INT | FOREIGN KEY, NOT NULL | 学生ID |
| assignment_id1 | INT | FOREIGN KEY, NOT NULL | 课程安排1ID |
| assignment_id2 | INT | FOREIGN KEY, NOT NULL | 课程安排2ID |
| conflict_type | ENUM('TIME', 'PREREQUISITE', 'CAPACITY') | NOT NULL | 冲突类型 |
| conflict_details | JSON | - | 冲突详情 |
| detected_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 检测时间 |
| resolved_at | TIMESTAMP | NULL | 解决时间 |

**索引：** idx_student_id, idx_detected_at

#### 2.8.2 待办事项表 (todos)
存储用户的待办事项信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 待办事项ID |
| user_id | INT | FOREIGN KEY, NOT NULL | 用户ID |
| text | VARCHAR(500) | NOT NULL | 待办事项内容 |
| completed | BOOLEAN | DEFAULT FALSE | 完成状态 |
| due_date | DATE | - | 截止日期 |
| important | BOOLEAN | DEFAULT FALSE | 是否重要 |
| category | VARCHAR(50) | - | 分类 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_user_id, idx_completed, idx_due_date, idx_important

#### 2.8.3 公告表 (announcements)
存储系统公告和通知信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 公告ID |
| title | VARCHAR(200) | NOT NULL | 公告标题 |
| content | TEXT | NOT NULL | 公告内容 |
| publish_date | DATE | NOT NULL | 发布日期 |
| expiry_date | DATE | CHECK约束 | 过期日期 |
| department_id | INT | FOREIGN KEY | 发布部门ID |
| announcement_type | ENUM('IMPORTANT', 'NOTICE', 'ACTIVITY', 'INFO') | DEFAULT 'NOTICE' | 公告类型 |
| priority | ENUM('LOW', 'MEDIUM', 'HIGH', 'URGENT') | DEFAULT 'MEDIUM' | 优先级 |
| created_by | INT | FOREIGN KEY, NOT NULL | 发布人ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_publish_date, idx_type, idx_priority, idx_department_id

#### 2.8.4 用户地址表 (user_addresses)
存储用户地址信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| address_id | INT | PRIMARY KEY, AUTO_INCREMENT | 地址ID（主键） |
| user_id | INT | FOREIGN KEY, NOT NULL | 用户ID |
| address_type | ENUM('HOME', 'SCHOOL', 'WORK') | DEFAULT 'HOME' | 地址类型 |
| province | VARCHAR(50) | - | 省份 |
| city | VARCHAR(50) | - | 城市 |
| district | VARCHAR(50) | - | 区县 |
| detail_address | VARCHAR(255) | - | 详细地址 |
| is_primary | BOOLEAN | DEFAULT FALSE | 是否主要地址 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引：** idx_user_id, idx_address_type

## 3. 数据库视图

### 3.1 学生学术统计视图 (student_academic_stats)
提供学生学术信息的综合视图。

**包含字段：** student_id, student_no, username, department_name, major_name, class_name, student_status, enrollment_date, education_years

### 3.2 课程统计视图 (course_statistics)
提供课程统计信息的综合视图。

**包含字段：** course_id, course_code, course_name, department_name, semester_id, academic_year, semester_name, total_students, avg_final_grade, avg_total_grade, min_final_grade, max_final_grade, passed_students, failed_students

### 3.3 教师授课统计视图 (teacher_course_stats)
提供教师授课统计信息的综合视图。

**包含字段：** teacher_id, teacher_no, username, department_name, title_name, teacher_status, total_assignments, total_students, avg_students_per_course, min_students, max_students

### 3.4 图书借阅统计视图 (book_borrowing_stats)
提供图书借阅统计信息的综合视图。

**包含字段：** book_id, isbn, book_title, author, category_name, total_copies, available_copies, total_borrowings, current_borrowings, avg_borrow_days

## 4. 数据库约束和完整性

### 4.1 外键约束
所有关联关系都通过外键约束确保数据完整性，采用级联删除和更新策略。

### 4.2 检查约束
- 日期范围检查（出生日期、入职日期、入学日期等）
- 数值范围检查（学分、课时、成绩等）
- 枚举值检查（状态、类型等）

### 4.3 唯一约束
- 用户名、邮箱、手机号等关键字段的唯一性
- 业务编号的唯一性（学号、教师编号、课程代码等）
- 组合唯一约束（如教师-课程-学期组合）

## 5. 索引策略

### 5.1 主键索引
所有表都有自增主键索引。

### 5.2 唯一索引
对关键业务字段建立唯一索引。

### 5.3 普通索引
- 查询频繁的字段（如状态、日期等）
- 外键字段
- 组合查询字段

### 5.4 覆盖索引
对复杂查询建立组合索引，提高查询性能。

## 6. 性能优化

### 6.1 表设计优化
- 合理的数据类型选择
- 适当的字段长度
- 避免过度规范化

### 6.2 索引优化
- 选择性高的字段优先建立索引
- 避免过度索引
- 定期分析索引使用情况

### 6.3 查询优化
- 使用视图简化复杂查询
- 合理使用连接查询
- 避免全表扫描

## 7. 数据安全

### 7.1 权限控制
- 基于角色的权限管理
- 细粒度的操作权限控制
- 数据访问权限控制

### 7.2 审计日志
- 完整的操作日志记录
- 敏感数据变更追踪
- 系统配置变更记录

### 7.3 数据备份
- 定期数据备份策略
- 事务日志备份
- 灾难恢复计划

---

*本文档最后更新日期：2024年*  
*数据库版本：MySQL 8.0+*  
*字符集：utf8mb4*  
*排序规则：utf8mb4_unicode_ci*